# 分布式唯一ID
## 为什么需要唯一ID？
分布式环境下需要全局订单唯一，从而实现幂等去重  
需要保证：
* 全局唯一
* 趋势递增：方便聚簇索引，有序的主键插入保证写入性能
* 单调递增：版本号、增量消息等，排序需求
* 信息安全
## 数据库自增长
双机房区分单双数
## UUID
生成一个32位16进制字符串（16字节的128位数据，通常以32位长度的字符串表示）（结合机器识别码（全局唯一的IEEE机器识别号，如果有网卡，从网卡MAC地址获得，没有网卡以其他方式获得），当前时间，一个随机数）。
优点：

* 性能好
* 扩展性高
* 本地生成
* 无网络消耗
缺点：
* 无法保证趋势递增
* UUID过长，存储在数据库中建立索引效率低
## Snowflake
Twitter开源，生成一个64bit（0和1）字符串（1bit不用，41bit表示存储时间戳，10bit表示工作机器id（5位数据标示位，5位机器标识位），12bit序列号）
结构：
* 首位符号位，一般为正数，0
* 41位符号戳(毫秒级)：时间戳并不是当前时间戳，而是存储时间戳的差值（当前时间戳-起始时间戳，起始时间戳由程序指定），理论可以使用(1<<41)/(1000x60x60x24x365)，69年。
* 10位数据机器位（逻辑分片ID，具体实现和机器本身无关系）：包括5位数据标识位和5位机器标识位，理论可以最多部署点位1 << 10 = 1024
* 12位毫秒内的序列号：同一节点，同一时刻（同意毫秒内）最多生成ID数1 << 12  - 1= 4095。来
** 最后生成64位Long型数值**
优点：
* 趋势递增，按时间有序
* 性能高，稳定性高，不依赖数据库等第三方系统
* 可以按照自身业务特性灵活分配bit位
缺点：
* 依赖机器时钟。时钟回拨会造成暂不可用或重复发号（分布式系统中，每台机器上的时钟不可能完全同步。在同步各个服务器的时间时，有一定几率发生时钟回拨（时间超了，往回拨））
