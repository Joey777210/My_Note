# 物联网平台中间件
## 中间件概述
中间件是物联网平台的数据汇总、分发的核心，起到承上启下的作用，其核心功能包括：**设备接入权限认证、数据上传与存储、数据与指令转发、为前端提供RESTful风格的API接口**。  
中间件以mosquitto为核心，利用mosquitto提供的权限接口，修改mosquitto源码。实现了**权限认证、数据存储与转发、设备配置、数据缓存、查询接口等功能**。
## 项目技术
Golang，mosquitto，MQTT，CGO，Redis，InfluxDB，RESTful
## mosquitto
### 简介
mosquitto是一款实现了消息推送协议MQTT v3.1 的开源消息代理软件，提供轻量级的，支持可发布/可订阅的的消息推送模式，使设备对设备之间的短消息通信变得简单，例如现在应用广泛的低功耗传感器，手机、嵌入式计算机、微型控制器等移动设备。  
Mosquitto采用发布/订阅的模式实现MQTT协议，这种设计模式将通信终端之间的关系统一到服务程序中进行管理，可极大减轻客户端的开发和维护工作。  
### 发布/订阅模式
发布订阅模式定义了如何向一个节点发布和订阅消息，这些节点被称为Topic。Topic可以被看作是消息传输的中介或管道，发布者publish消息到topic，订阅者subscribe topic而获得消息。这种模式使得发布者和订阅者保持相互独立，实现了解耦。  
在TCP连接中，每个连接都由<源IP，源端口，目的ip，目的端口，通信协议>这五个元素确定，在一条TCP连接建立后，它需要在一段时间内一直被通信双方保持，以备下次数据传输使用。如果通信数量多，那么需要每个终端维持它所有的通信关系。  
发布订阅模式就是为了解决这个问题，**使每个终端只需要保持自己与服务器之间的连接，而客户端之间的关系由中间件维护**，这种设计模式将复杂的通信关系维护工作从客户端剥离出来，方便了客户端的开发和维护。  
在mosquitto中，程序就是通过这种方式工作，将客户端之间的关系通过**一棵订阅树**来维持。  
