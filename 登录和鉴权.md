# 登录和鉴权
## 登录
### 登录实际上做了什么
一个完整的登录流程，其实要做的只有一件事，就是拿到用户输入的账号密码去和数据库比对，但在这个过程中，会遇到安全性问题。
### 如何保证安全性
我们从用户输入账号密码开始看。  
首先用户输入密码后应当有验证码，避免是机器在做暴力破解。  
其次，http传输时账号密码可能会被拦截，所以我们必须要加密账号密码。一般常用的做法是，将密码加盐后使用HMAC如MD5或SHA-1后发送，并采用https协议。  
再次，如果加密后的账号密码被拦截也有可能会被伪造请求，所以后端要进行再次加密，一般是继续加盐，继续HMAC，重复几十次后，将结果存储在数据库中，用户登录时以同样的流程加密，与数据库中的数据进行比对。  
最后，涉及到数据库被盗的情况，目前还没有涉猎。待完善。 

### 如何保持登陆状态
HTTP协议作为无状态协议，后端并不知道两次请求是否来自同一个用户，那么就需要请求中夹带一些“私货”或者“标志”，用来判断请求的来源。  
一般常用的有两种带货方式。  

* cookie + session：   
> cookie也就是http header中原本就存在的一个字段，由浏览器保持。如果浏览器中存储了本域名的cookie，那么请求时会自动带上。我们就可以将用户的唯一标识如用户名，加密之后放在这里，由后端验证。    
> session的意思是会话，由后端保持。每生成一个新的session，都会伴随生成一个JSESSION-ID，并自动返回一个Set-Cookie字段，在前端浏览器中保存这个ID作为下次请求携带的Cookie值，如果两次携带的JSESSIONID相同，那么后端就知道这两次请求来自同一个用户。这整个流程在JAVA中是TOMCAT完成的，默认是保存在内存中的。那么我们使用其他语言或者数据量大时，一般是将Cookie作为一个字段存储在数据库中，以便后续比对，并会设置过期时间，定期更新。
> 其实cookie + session也就是可以理解为一个键值对，用cookie去查就能查到是哪个session，即哪个用户，cookie是不需要存储用户信息的，用户信息可以完全不用离开后端。
* Token：
> Token这种方式其实跟纯cookie有些类似，后端不需要存储数据，只需要定期生成和更新Token发给前端，由前端保存后请求时带上。有没有发现跟Cookie一样，其实Token就可以作为Cookie来发送，也可以单独写一个字段发送。  
> Token一般采用加密后的JSON，其中存储很多数据，例如用户信息，权力等级，生成时间，过期时间，还可以携带一些其他数据。  \
> Java中常用JWT来生成Token，在后端设置Filter来对Token进行过滤。
## 鉴权
### 鉴权是什么
鉴权也就是对用户权力的鉴定，区分不同级别的用户和管理员，不同权力的用户看到的界面不同，可以调用的数据和接口也不同。  
### 怎么做鉴权
首先权力规定后要与用户产生关联，一般是单独建表存储。可以将权力作为一个字段写在Token中，也可以每次请求来了都去查一次库。  
注意鉴权要使用Filter或Interceptor屏蔽不能被当前用户访问的接口。  
鉴权一定要由后端来做，前端做的鉴权是不安全的。  
